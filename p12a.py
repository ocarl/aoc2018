from collections import defaultdict

instring = '''#..#.#..##......###...###'''

# instring = '''#....##.#.#.####..#.######..##.#.########..#...##...##...##.#.#...######.###....#...##..#.#....##.##'''

rules = '''...## => #
..#.. => #
.#... => #
.#.#. => #
.#.## => #
.##.. => #
.#### => #
#.#.# => #
#.### => #
##.#. => #
##.## => #
###.. => #
###.# => #
####. => #'''

# rules = '''.#.## => #
# .#.#. => #
# #.#.# => .
# .#### => .
# .#... => .
# #..## => .
# ..#.# => #
# #.#.. => .
# ##### => .
# ....# => .
# ...## => .
# ..##. => .
# ##.#. => #
# ##..# => .
# ##... => #
# ..### => #
# .##.. => #
# ###.. => .
# #..#. => .
# ##.## => .
# ..#.. => #
# .##.# => #
# ####. => #
# #.### => .
# #...# => #
# ###.# => #
# ...#. => #
# .###. => .
# .#..# => #
# ..... => .
# #.... => .
# #.##. => #'''

facit = '''...#..#.#..##......###...###...........
...#...#....#.....#..#..#..#...........
...##..##...##....#..#..#..##..........
..#.#...#..#.#....#..#..#...#..........
...#.#..#...#.#...#..#..##..##.........
....#...##...#.#..#..#...#...#.........
....##.#.#....#...#..##..##..##........
...#..###.#...##..#...#...#...#........
...#....##.#.#.#..##..##..##..##.......
...##..#..#####....#...#...#...#.......
..#.#..#...#.##....##..##..##..##......
...#...##...#.#...#.#...#...#...#......
...##.#.#....#.#...#.#..##..##..##.....
..#..###.#....#.#...#....#...#...#.....
..#....##.#....#.#..##...##..##..##....
..##..#..#.#....#....#..#.#...#...#....
.#.#..#...#.#...##...#...#.#..##..##...
..#...##...#.#.#.#...##...#....#...#...
..##.#.#....#####.#.#.#...##...##..##..
.#..###.#..#.#.#######.#.#.#..#.#...#..
.#....##....#####...#######....#.#..##.'''.split('\n')




rules_dict = defaultdict(lambda: '.')
rules_dict = dict()


for line in rules.split('\n'):
    rule, res = line.split('=>')
    rule = rule.rstrip()
    res = res.rstrip()
    rule = rule.strip()
    res = res.strip()
    rules_dict[rule] = res

# instring = '.....' + instring + '.............'

# print(instring+ '0')

pad_str = ''
orig_len = len(instring)

pad_num = 0

print(instring)
print(instring)

for turn in range(20):
    aa = ''
    eval_index = instring.find('#')
    pad_str = '.'*(4-eval_index)
    pad_num += len(pad_str)
    instring = pad_str + instring
    for i in range(len(instring)+4):
        a_slice = instring[i-2:i+3]
        if len(a_slice) < 5:
            aa += '.'
            continue
        try:
            aa += rules_dict[a_slice]
        except:
            aa += '.'
    print(aa)
    print(facit[turn+1])
    instring = aa


tot = 0
for i, char in enumerate(instring):
    if char == '#':
        tot += i-pad_num

print(tot)







